# liquibase-k8s-openshift

Works with ArgoCD + Kubernets/OpenShift + Kustomize

# Useful Commands  

1. Build Docker Image  
`docker build -t image:tag .`  

2. To view YAML generated by Kustomize  
`kubectl kustomize`  

3. Apply to K8S / Openshift using Kustomize   
`kubectl apply -k .`  

# Enviroment Variables 

| Variable | Description | 
| -------- | ----------- |
| `APP_INITCONTAINER_ENABLE` | Enable/disable to run on initContainers mode for k8s. Run and exit. Defaults `false` |
| `LIQUIBASE_ENABLE` | Enable/disable Liquibase. Defaults to `true` |
| `LIQUIBASE_URL` | JDBC URL Connection. Equals to --url | 
| `LIQUIBASE_USERNAME` | JDBC Username. Equals to --username |
| `LIQUIBASE_PASSWORD` | JDBC Password. Equals to --password |
| `LIQUIBASE_DEFAULT_SCHEMA_NAME` |  Specifies the default schema to use for managed database objects and for Liquibase control tables. Equals to --default-schema-name |
| `LIQUIBASE_CHANGELOGFILE` | Default Schema to use with Liquibase. Equals to --changelog-file |

# Notes
Based on [liquibase-springboot](https://github.com/brunobenchimol/liquibase-springboot).  

# TODO
Make it run flawlessy on a s2i build on OpenShift. If you do not have a CI (e.g.: tekton pipeline) to properly get changelog modifications.  

# References

1. https://github.com/liquibase/docker
2. https://www.liquibase.com/blog/using-liquibase-in-kubernetes
3. https://gitlab.com/tofik.mikailov/liquibase-init-container
4. https://piotrminkowski.com/2021/12/13/continuous-delivery-on-kubernetes-with-database-using-argocd-and-liquibase/
5. https://www.youtube.com/watch?v=Fn3J6KyCjBA
6. https://spring.io/guides/gs/spring-boot-docker/